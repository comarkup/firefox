<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoMarkup Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fb;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .demo-buttons {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: #2563eb;
            color: white;
            cursor: pointer;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            position: relative;
            margin: 20px 0;
        }

        code {
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="demo-buttons">
        <button onclick="loadSimpleComponent()">Simple Component</button>
        <button onclick="loadComplexComponent()">Complex Component</button>
        <button onclick="clearContent()">Clear</button>
    </div>
    <div id="content"></div>
</div>

<script>
    // Obserwator zmian w DOM
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.addedNodes.length) {
                checkForNewCodeBlocks();
            }
        });
    });

    observer.observe(document.body, {
        childList: true,
        subtree: true
    });

    // Dodawanie przycisku renderowania
    function addRenderButton(codeBlock) {
        if (codeBlock.parentElement.querySelector('.render-button')) return;

        const button = document.createElement('button');
        button.textContent = 'Renderuj';
        button.className = 'render-button';
        button.style.position = 'absolute';
        button.style.top = '10px';
        button.style.right = '10px';

        button.onclick = () => renderCode(codeBlock);
        codeBlock.parentElement.appendChild(button);
    }

    // Sprawdzanie nowych bloków kodu
    function checkForNewCodeBlocks() {
        document.querySelectorAll('pre code').forEach(block => {
            if (!block.hasAttribute('data-processed')) {
                addRenderButton(block);
                block.setAttribute('data-processed', 'true');
            }
        });
    }

    // Renderowanie kodu w popupie
    function renderCode(codeBlock) {
        const code = codeBlock.textContent;
        const popup = window.open('', 'React Preview', 'width=800,height=600');

        const popupContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>React Preview</title>
                    <script src="https://unpkg.com/react@17/umd/react.development.js"><\/script>
                    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"><\/script>
                    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"><\/script>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            padding: 20px;
                            margin: 0;
                            background: #f5f7fb;
                        }
                        #root {
                            background: white;
                            padding: 20px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                            min-height: 100px;
                        }
                        .controls {
                            margin-top: 20px;
                        }
                        button {
                            padding: 8px 16px;
                            border: none;
                            border-radius: 4px;
                            background: #2563eb;
                            color: white;
                            cursor: pointer;
                            margin-right: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div id="root"></div>
                    <div class="controls">
                        <button onclick="copyToClipboard()">Copy HTML</button>
                        <button onclick="window.close()">Close</button>
                    </div>

                    <script type="text/babel">
                        const App = () => {
                            try {
                                ${code}
                            } catch (error) {
                                return <div style={{color: 'red'}}>Error: {error.message}</div>;
                            }
                        };

                        ReactDOM.render(<App />, document.getElementById('root'));
                    <\/script>

                    <script>
                        function copyToClipboard() {
                            const html = document.getElementById('root').innerHTML;
                            navigator.clipboard.writeText(html)
                                .then(() => alert('Copied to clipboard!'))
                                .catch(err => alert('Error copying: ' + err));
                        }
                    <\/script>
                </body>
                </html>
            `;

        popup.document.write(popupContent);
        popup.document.close();
    }

    // Ładowanie przykładowych komponentów
    function loadSimpleComponent() {
        const code =
            `const Welcome = () => {
    return <h1>Hello CoMarkup!</h1>;
};

return <Welcome />;`;

        document.getElementById('content').innerHTML = `<pre><code>${code}</code></pre>`;
    }

    function loadComplexComponent() {
        const code =
            `const Counter = () => {
    const [count, setCount] = React.useState(0);

    return (
        <div style={{textAlign: 'center'}}>
            <h2>Count: {count}</h2>
            <button
                onClick={() => setCount(count + 1)}
                style={{
                    padding: '10px 20px',
                    background: '#2563eb',
                    color: 'white',
                    border: 'none',
                    borderRadius: '4px'
                }}
            >
                Increment
            </button>
        </div>
    );
};

return <Counter />;`;

        document.getElementById('content').innerHTML = `<pre><code>${code}</code></pre>`;
    }

    function clearContent() {
        document.getElementById('content').innerHTML = '';
    }

    // Inicjalne sprawdzenie bloków kodu
    checkForNewCodeBlocks();
</script>
</body>
</html>
